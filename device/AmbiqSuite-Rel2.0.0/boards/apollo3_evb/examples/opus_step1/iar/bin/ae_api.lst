###############################################################################
#
# IAR ANSI C/C++ Compiler V8.32.2.178/W32 for ARM         12/Mar/2019  09:51:28
# Copyright 1999-2018 IAR Systems AB.
#
#    Cpu mode     =  
#    Endian       =  little
#    Source file  =  C:\Users\agao\Downloads\opus_step1\opus_step1\src\ae_api.c
#    Command line =  
#        -f C:\temp\EW2C67.tmp
#        (C:\Users\agao\Downloads\opus_step1\opus_step1\src\ae_api.c -D iar -D
#        AM_PART_APOLLO3 -D AM_PACKAGE_BGA -lcN
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\bin --diag_suppress
#        Pa050 -o C:\Users\agao\Downloads\opus_step1\opus_step1\iar\bin
#        --no_cse --no_unroll --no_inline --no_code_motion --no_tbaa
#        --no_clustering --no_scheduling --debug --endian=little
#        --cpu=Cortex-M4 -e --fpu=VFPv4_sp --dlib_config "C:\Program Files
#        (x86)\IAR Systems\Embedded Workbench
#        8.2\arm\inc\c\DLib_Config_Normal.h" -I
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\..\..\..\..\..\utils\
#        -I
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\..\..\..\..\..\CMSIS\ARM\Include\
#        -I
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\..\..\..\..\..\CMSIS\AmbiqMicro\Include\
#        -I
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\..\..\..\..\..\mcu\apollo3\
#        -I
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\..\..\..\..\..\devices\
#        -I C:\Users\agao\Downloads\opus_step1\opus_step1\iar\..\..\..\bsp\ -I
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\..\..\..\..\..\ -I
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\..\src\ -I
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\..\src\sound\ -On)
#    Locale       =  C
#    List file    =  
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\bin\ae_api.lst
#    Object file  =  
#        C:\Users\agao\Downloads\opus_step1\opus_step1\iar\bin\ae_api.o
#
###############################################################################

C:\Users\agao\Downloads\opus_step1\opus_step1\src\ae_api.c
      1          // tst_octopus.cpp : This file contains the 'main' function. Program execution begins and ends there.
      2          //
      3          
      4          #include <stdio.h>
      5          typedef void* spl_opus_encoder_h;
      6          spl_opus_encoder_h* octopus_encoder_create();
      7          int octopus_encode(spl_opus_encoder_h *st, const short *pcm, int frame_size, unsigned char *data, int out_data_bytes);
      8          
      9          spl_opus_encoder_h *p_spl_opus_encoder;
     10          
     11          int audio_enc_init()
     12          {
     13            p_spl_opus_encoder = octopus_encoder_create();
     14            return 0;
     15          }
     16          
     17          int audio_enc_encode_frame(short *p_pcm_buffer, int n_pcm_samples, unsigned char *p_encoded_buffer)
     18          {
     19            int n = 0, m;
     20            int hdr = 8;
     21            int size = 1500; //todo
     22            int rng = 0;
     23                reset_alloca_pool();
     24                n = octopus_encode(p_spl_opus_encoder, p_pcm_buffer, n_pcm_samples, &p_encoded_buffer[hdr], size);
     25                reset_alloca_pool();
     26                opus_encoder_enc_range(p_spl_opus_encoder, &rng);
     27                
     28                {
     29                  char *p1 = (char*)(&n);
     30                  char *p2 = (char*)(&rng);
     31                  for(int i = 0; i < 4; i++) {
     32                    p_encoded_buffer[i] = p1[3-i];
     33                    p_encoded_buffer[4 + i] = p2[3-i];
     34                  }
     35                }
     36                //printf("   stack usage = %d\n", m);
     37                
     38                return n + hdr;
     39          }
     40          // Run program: Ctrl + F5 or Debug > Start Without Debugging menu
     41          // Debug program: F5 or Debug > Start Debugging menu
     42          
     43          // Tips for Getting Started: 
     44          //   1. Use the Solution Explorer window to add/manage files
     45          //   2. Use the Team Explorer window to connect to source control
     46          //   3. Use the Output window to see build output and other messages
     47          //   4. Use the Error List window to view errors
     48          //   5. Go to Project > Add New Item to create new code files, or Project > Add Existing Item to add existing code files to the project
     49          //   6. In the future, to open this project again, go to File > Open > Project and select the .sln file
     50          
     51          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      40   audio_enc_encode_frame
        40   -> octopus_encode
        40   -> opus_encoder_enc_range
        40   -> reset_alloca_pool
       8   audio_enc_init
         8   -> octopus_encoder_create


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable1
     114  audio_enc_encode_frame
      14  audio_enc_init
       4  p_spl_opus_encoder

 
   4 bytes in section .bss
 132 bytes in section .text
 
 132 bytes of CODE memory
   4 bytes of DATA memory

Errors: none
Warnings: 3
